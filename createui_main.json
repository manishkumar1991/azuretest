{
    "$schema": "https://schema.management.azure.com/schemas/0.1.2-preview/CreateUIDefinition.MultiVm.json#",
    "handler": "Microsoft.Azure.CreateUIDef",
    "version": "0.1.2-preview",
    "parameters": {
        "config": {
            "isWizard": false,
            "basics": {
                "description": "<img src=\"https://raw.githubusercontent.com/Azure/Azure-Sentinel/master/Workbooks/Images/Logos/Azure_Sentinel.svg\" width=\"75px\" height=\"75px\">\n\nThis data connector helps to ingest data from **Claroty**",
                "subscription": {
                    "resourceProviders": [
                        "Microsoft.Insights/dataCollectionRules",
                        "Microsoft.OperationalInsights/workspaces",
                        "Microsoft.Compute/virtualMachines",
                        "Microsoft.ResourceGraph/resources"
                    ]
                },
                "resourceGroup": {
                    "allowExisting": true
                }
            }
        },
        "basics": [
            {
                "name": "getLAWorkspace",
                "type": "Microsoft.Solutions.ArmApiControl",
                "toolTip": "This filters by workspaces that exist in the Resource Group selected",
                "condition": "[greater(length(resourceGroup().name),0)]",
                "request": {
                    "method": "GET",
                    "path": "[concat(subscription().id,'/providers/Microsoft.OperationalInsights/workspaces?api-version=2020-08-01')]"
                }
            },
            {
                "name": "loganalyticsworkspace",
                "type": "Microsoft.Common.DropDown",
                "label": "Log analytics Workspace",
                "placeholder": "Select a workspace",
                "toolTip": "This dropdown will list only workspace that exists in the Resource Group selected",
                "constraints": {
                    "allowedValues": "[map(filter(basics('getLAWorkspace').value, (filter) => contains(toLower(filter.id), toLower(resourceGroup().name))), (item) => parse(concat('{\"label\":\"', item.name, '\",\"value\":\"', item.name, '\"}')))]",
                    "required": true
                },
                "visible": true
            }
        ],
        "steps": [
            {
                "name": "DCR Creation",
                "label": "DCR Creation",
                "bladeTitle": "DCR Creation",
                "elements": [
                    {
                        "name": "Resourcesection",
                        "type": "Microsoft.Common.Section",
                        "label": "Resources",
                        "elements": [
                            {
                                "name": "Resourcesection-text",
                                "type": "Microsoft.Common.TextBlock",
                                "options": {
                                    "text": "Choose a machine to collect data from. This machines will replace any previous selection, make sure to re-select any you would like to keep. The Azure Monitor Agent will automatically be installed"
                                }
                            }
                        ]
                    },
                    {
                        "name": "vmselectapi",
                        "type": "Microsoft.Solutions.ArmApiControl",
                        "request": {
                            "method": "POST",
                            "path": "/providers/Microsoft.ResourceGraph/resources?api-version=2021-03-01",
                            "body": {
                                "query": "Resources| project name, location, resourceGroup, properties.storageProfile.osDisk.osType,properties.osName, subscriptionId , type | where type in ('microsoft.compute/virtualmachines','microsoft.hybridcompute/machines')"
                            }
                        }
                    },
                    {
                        "name": "VMselectdropdown",
                        "type": "Microsoft.Common.DropDown",
                        "label": "Available Virtual Machines",
                        "placeholder": "",
                        "toolTip": "Select the VM from which logs to be collected",
                        "filterPlaceholder": "Filter VM ...",
                        "filter": true,
                        "constraints": {
                            "allowedValues": "[map(steps('DCR Creation').vmselectapi.data, (item) =>  parse(concat('{\"label\":\"', item.name, '\",\"value\":\"', item.name, '\"}')))]",
                            "required": true
                        },
                        "visible": true
                    },
                    {
                        "name": "CollectSection",
                        "type": "Microsoft.Common.Section",
                        "label": "Collect",
                        "elements": [
                            {
                                "name": "Collectsection1",
                                "type": "Microsoft.Common.TextBlock",
                                "options": {
                                    "text": "Select which data source type and the data to collect for your resources(s)"
                                }
                            },
                            {
                                "name": "collectinformationblock",
                                "type": "Microsoft.Common.InfoBox",
                                "visible": true,
                                "options": {
                                    "icon": "Info",
                                    "text": "Please select at least 1 facility to be collected"
                                }
                            },
                            {
                                "name": "facility1",
                                "type": "Microsoft.Common.DropDown",
                                "label": "LOG_AUTH",
                                "placeholder": "",
                                "toolTip": "",
								"filter": true,								
                                "constraints": {
                                    "allowedValues": [
									    {
                                            "label": "None",
                                            "value": null
                                        },									
                                        {
                                            "label": "Debug",
                                            "value": "auth_Debug"
                                        },
                                        {
                                            "label": "Info",
                                            "value": "auth_Info"
                                        },
                                        {
                                            "label": "Notice",
                                            "value": "auth_Notice"
                                        },
                                        {
                                            "label": "Warning",
                                            "value": "auth_Warning"
                                        },
                                        {
                                            "label": "Error",
                                            "value": "auth_Error"
                                        },
                                        {
                                            "label": "Critical",
                                            "value": "auth_Critical"
                                        },
                                        {
                                            "label": "Alert",
                                            "value": "auth_Alert"
                                        },
                                        {
                                            "label": "Emergency",
                                            "value": "auth_Emergency"
                                        }
                                    ]
                                },
                                "visible": true
                            },
                            {
                                "name": "facility2",
                                "type": "Microsoft.Common.DropDown",
                                "label": "LOG_AUTHPRIV",
                                "placeholder": "",
                                "toolTip": "",
								"filter": true,
                                "filterPlaceholder": "Choose log level",
                                "constraints": {
                                    "allowedValues": [
									    {
                                            "label": "None",
                                            "value": null
                                        },
                                        {
                                            "label": "Debug",
                                            "value": "authpriv_Debug"
                                        },
                                        {
                                            "label": "Info",
                                            "value": "authpriv_Info"
                                        },
                                        {
                                            "label": "Notice",
                                            "value": "authpriv_Notice"
                                        },
                                        {
                                            "label": "Warning",
                                            "value": "authpriv_Warning"
                                        },
                                        {
                                            "label": "Error",
                                            "value": "authpriv_Error"
                                        },
                                        {
                                            "label": "Critical",
                                            "value": "authpriv_Critical"
                                        },
                                        {
                                            "label": "Alert",
                                            "value": "authpriv_Alert"
                                        },
                                        {
                                            "label": "Emergency",
                                            "value": "authpriv_Emergency"
                                        }
                                    ]
                                },
                                "visible": true
                            },
                            {
                                "name": "facility3",
                                "type": "Microsoft.Common.DropDown",
                                "label": "LOG_CRON",
                                "placeholder": "",
                                "toolTip": "",
								"filter": true,
                                "filterPlaceholder": "Choose log level",
                                "constraints": {
                                    "allowedValues": [
									    {
                                            "label": "None",
                                            "value": null
                                        },
                                        {
                                            "label": "Debug",
                                            "value": "cron_Debug"
                                        },
                                        {
                                            "label": "Info",
                                            "value": "cron_Info"
                                        },
                                        {
                                            "label": "Notice",
                                            "value": "cron_Notice"
                                        },
                                        {
                                            "label": "Warning",
                                            "value": "cron_Warning"
                                        },
                                        {
                                            "label": "Error",
                                            "value": "cron_Error"
                                        },
                                        {
                                            "label": "Critical",
                                            "value": "cron_Critical"
                                        },
                                        {
                                            "label": "Alert",
                                            "value": "cron_Alert"
                                        },
                                        {
                                            "label": "Emergency",
                                            "value": "cron_Emergency"
                                        }
                                    ]
                                },
                                "visible": true
                            },
{
                                "name": "facility4",
                                "type": "Microsoft.Common.DropDown",
                                "label": "LOG_DAEMON",
                                "placeholder": "",
                                "toolTip": "",
                                "constraints": {
                                    "allowedValues": [
                                        {
                                            "label": "None",
                                            "value": null
                                        },
                                        {
                                            "label": "Debug",
                                            "value": "daemon_Debug"
                                        },
                                        {
                                            "label": "Info",
                                            "value": "daemon_Info"
                                        },
                                        {
                                            "label": "Notice",
                                            "value": "daemon_Notice"
                                        },
                                        {
                                            "label": "Warning",
                                            "value": "daemon_Warning"
                                        },
                                        {
                                            "label": "Error",
                                            "value": "daemon_Error"
                                        },
                                        {
                                            "label": "Critical",
                                            "value": "daemon_Critical"
                                        },
                                        {
                                            "label": "Alert",
                                            "value": "daemon_Alert"
                                        },
                                        {
                                            "label": "Emergency",
                                            "value": "daemon_Emergency"
                                        }
                                    ]
                                },
                                "visible": true
                            },
                            {
                                "name": "facility5",
                                "type": "Microsoft.Common.DropDown",
                                "label": "LOG_MARK",
                                "placeholder": "",
                                "toolTip": "",
                                "constraints": {
                                    "allowedValues": [
                                        {
                                            "label": "None",
                                            "value": null
                                        },
                                        {
                                            "label": "Debug",
                                            "value": "mark_Debug"
                                        },
                                        {
                                            "label": "Info",
                                            "value": "mark_Info"
                                        },
                                        {
                                            "label": "Notice",
                                            "value": "mark_Notice"
                                        },
                                        {
                                            "label": "Warning",
                                            "value": "mark_Warning"
                                        },
                                        {
                                            "label": "Error",
                                            "value": "mark_Error"
                                        },
                                        {
                                            "label": "Critical",
                                            "value": "mark_Critical"
                                        },
                                        {
                                            "label": "Alert",
                                            "value": "mark_Alert"
                                        },
                                        {
                                            "label": "Emergency",
                                            "value": "mark_Emergency"
                                        }
                                    ]
                                },
                                "visible": true
                            },
                            {
                                "name": "facility6",
                                "type": "Microsoft.Common.DropDown",
                                "label": "LOG_KERN",
                                "placeholder": "",
                                "toolTip": "",
                                "constraints": {
                                    "allowedValues": [
                                        {
                                            "label": "None",
                                            "value": null
                                        },
                                        {
                                            "label": "Debug",
                                            "value": "kern_Debug"
                                        },
                                        {
                                            "label": "Info",
                                            "value": "kern_Info"
                                        },
                                        {
                                            "label": "Notice",
                                            "value": "kern_Notice"
                                        },
                                        {
                                            "label": "Warning",
                                            "value": "kern_Warning"
                                        },
                                        {
                                            "label": "Error",
                                            "value": "kern_Error"
                                        },
                                        {
                                            "label": "Critical",
                                            "value": "kern_Critical"
                                        },
                                        {
                                            "label": "Alert",
                                            "value": "kern_Alert"
                                        },
                                        {
                                            "label": "Emergency",
                                            "value": "kern_Emergency"
                                        }
                                    ]
                                },
                                "visible": true
                            },
                            {
                                "name": "facility7",
                                "type": "Microsoft.Common.DropDown",
                                "label": "LOG_LOCAL0",
                                "placeholder": "",
                                "toolTip": "",
                                "constraints": {
                                    "allowedValues": [
                                        {
                                            "label": "None",
                                            "value": null
                                        },
                                        {
                                            "label": "Debug",
                                            "value": "local0_Debug"
                                        },
                                        {
                                            "label": "Info",
                                            "value": "local0_Info"
                                        },
                                        {
                                            "label": "Notice",
                                            "value": "local0_Notice"
                                        },
                                        {
                                            "label": "Warning",
                                            "value": "local0_Warning"
                                        },
                                        {
                                            "label": "Error",
                                            "value": "local0_Error"
                                        },
                                        {
                                            "label": "Critical",
                                            "value": "local0_Critical"
                                        },
                                        {
                                            "label": "Alert",
                                            "value": "local0_Alert"
                                        },
                                        {
                                            "label": "Emergency",
                                            "value": "local0_Emergency"
                                        }
                                    ]
                                },
                                "visible": true
                            },
                            {
                                "name": "facility8",
                                "type": "Microsoft.Common.DropDown",
                                "label": "LOG_LOCAL1",
                                "placeholder": "",
                                "toolTip": "",
                                "constraints": {
                                    "allowedValues": [
                                        {
                                            "label": "None",
                                            "value": null
                                        },
                                        {
                                            "label": "Debug",
                                            "value": "local1_Debug"
                                        },
                                        {
                                            "label": "Info",
                                            "value": "local1_Info"
                                        },
                                        {
                                            "label": "Notice",
                                            "value": "local1_Notice"
                                        },
                                        {
                                            "label": "Warning",
                                            "value": "local1_Warning"
                                        },
                                        {
                                            "label": "Error",
                                            "value": "local1_Error"
                                        },
                                        {
                                            "label": "Critical",
                                            "value": "local1_Critical"
                                        },
                                        {
                                            "label": "Alert",
                                            "value": "local1_Alert"
                                        },
                                        {
                                            "label": "Emergency",
                                            "value": "local1_Emergency"
                                        }
                                    ]
                                },
                                "visible": true
                            },
                            {
                                "name": "facility9",
                                "type": "Microsoft.Common.DropDown",
                                "label": "LOG_LOCAL2",
                                "placeholder": "",
                                "toolTip": "",
                                "constraints": {
                                    "allowedValues": [
                                        {
                                            "label": "None",
                                            "value": null
                                        },
                                        {
                                            "label": "Debug",
                                            "value": "local2_Debug"
                                        },
                                        {
                                            "label": "Info",
                                            "value": "local2_Info"
                                        },
                                        {
                                            "label": "Notice",
                                            "value": "local2_Notice"
                                        },
                                        {
                                            "label": "Warning",
                                            "value": "local2_Warning"
                                        },
                                        {
                                            "label": "Error",
                                            "value": "local2_Error"
                                        },
                                        {
                                            "label": "Critical",
                                            "value": "local2_Critical"
                                        },
                                        {
                                            "label": "Alert",
                                            "value": "local2_Alert"
                                        },
                                        {
                                            "label": "Emergency",
                                            "value": "local2_Emergency"
                                        }
                                    ]
                                },
                                "visible": true
                            },
                            {
                                "name": "facility10",
                                "type": "Microsoft.Common.DropDown",
                                "label": "LOG_LOCAL3",
                                "placeholder": "",
                                "toolTip": "",
                                "constraints": {
                                    "allowedValues": [
                                        {
                                            "label": "None",
                                            "value": null
                                        },
                                        {
                                            "label": "Debug",
                                            "value": "local3_Debug"
                                        },
                                        {
                                            "label": "Info",
                                            "value": "local3_Info"
                                        },
                                        {
                                            "label": "Notice",
                                            "value": "local3_Notice"
                                        },
                                        {
                                            "label": "Warning",
                                            "value": "local3_Warning"
                                        },
                                        {
                                            "label": "Error",
                                            "value": "local3_Error"
                                        },
                                        {
                                            "label": "Critical",
                                            "value": "local3_Critical"
                                        },
                                        {
                                            "label": "Alert",
                                            "value": "local3_Alert"
                                        },
                                        {
                                            "label": "Emergency",
                                            "value": "local3_Emergency"
                                        }
                                    ]
                                },
                                "visible": true
                            },
                            {
                                "name": "facility11",
                                "type": "Microsoft.Common.DropDown",
                                "label": "LOG_LOCAL4",
                                "placeholder": "",
                                "toolTip": "",
                                "constraints": {
                                    "allowedValues": [
                                        {
                                            "label": "None",
                                            "value": null
                                        },
                                        {
                                            "label": "Debug",
                                            "value": "local4_Debug"
                                        },
                                        {
                                            "label": "Info",
                                            "value": "local4_Info"
                                        },
                                        {
                                            "label": "Notice",
                                            "value": "local4_Notice"
                                        },
                                        {
                                            "label": "Warning",
                                            "value": "local4_Warning"
                                        },
                                        {
                                            "label": "Error",
                                            "value": "local4_Error"
                                        },
                                        {
                                            "label": "Critical",
                                            "value": "local4_Critical"
                                        },
                                        {
                                            "label": "Alert",
                                            "value": "local4_Alert"
                                        },
                                        {
                                            "label": "Emergency",
                                            "value": "local4_Emergency"
                                        }
                                    ]
                                },
                                "visible": true
                            },
                            {
                                "name": "facility12",
                                "type": "Microsoft.Common.DropDown",
                                "label": "LOG_LOCAL5",
                                "placeholder": "",
                                "toolTip": "",
                                "constraints": {
                                    "allowedValues": [
                                        {
                                            "label": "None",
                                            "value": null
                                        },
                                        {
                                            "label": "Debug",
                                            "value": "local5_Debug"
                                        },
                                        {
                                            "label": "Info",
                                            "value": "local5_Info"
                                        },
                                        {
                                            "label": "Notice",
                                            "value": "local5_Notice"
                                        },
                                        {
                                            "label": "Warning",
                                            "value": "local5_Warning"
                                        },
                                        {
                                            "label": "Error",
                                            "value": "local5_Error"
                                        },
                                        {
                                            "label": "Critical",
                                            "value": "local5_Critical"
                                        },
                                        {
                                            "label": "Alert",
                                            "value": "local5_Alert"
                                        },
                                        {
                                            "label": "Emergency",
                                            "value": "local5_Emergency"
                                        }
                                    ]
                                },
                                "visible": true
                            },
                            {
                                "name": "facility13",
                                "type": "Microsoft.Common.DropDown",
                                "label": "LOG_LOCAL6",
                                "placeholder": "",
                                "toolTip": "",
                                "constraints": {
                                    "allowedValues": [
                                        {
                                            "label": "None",
                                            "value": null
                                        },
                                        {
                                            "label": "Debug",
                                            "value": "local6_Debug"
                                        },
                                        {
                                            "label": "Info",
                                            "value": "local6_Info"
                                        },
                                        {
                                            "label": "Notice",
                                            "value": "local6_Notice"
                                        },
                                        {
                                            "label": "Warning",
                                            "value": "local6_Warning"
                                        },
                                        {
                                            "label": "Error",
                                            "value": "local6_Error"
                                        },
                                        {
                                            "label": "Critical",
                                            "value": "local6_Critical"
                                        },
                                        {
                                            "label": "Alert",
                                            "value": "local6_Alert"
                                        },
                                        {
                                            "label": "Emergency",
                                            "value": "local6_Emergency"
                                        }
                                    ]
                                },
                                "visible": true
                            },
                            {
                                "name": "facility14",
                                "type": "Microsoft.Common.DropDown",
                                "label": "LOG_LOCAL7",
                                "placeholder": "",
                                "toolTip": "",
                                "constraints": {
                                    "allowedValues": [
                                        {
                                            "label": "None",
                                            "value": null
                                        },
                                        {
                                            "label": "Debug",
                                            "value": "local7_Debug"
                                        },
                                        {
                                            "label": "Info",
                                            "value": "local7_Info"
                                        },
                                        {
                                            "label": "Notice",
                                            "value": "local7_Notice"
                                        },
                                        {
                                            "label": "Warning",
                                            "value": "local7_Warning"
                                        },
                                        {
                                            "label": "Error",
                                            "value": "local7_Error"
                                        },
                                        {
                                            "label": "Critical",
                                            "value": "local7_Critical"
                                        },
                                        {
                                            "label": "Alert",
                                            "value": "local7_Alert"
                                        },
                                        {
                                            "label": "Emergency",
                                            "value": "local7_Emergency"
                                        }
                                    ]
                                },
                                "visible": true
                            },
                            {
                                "name": "facility15",
                                "type": "Microsoft.Common.DropDown",
                                "label": "LOG_LPR",
                                "placeholder": "",
                                "toolTip": "",
                                "constraints": {
                                    "allowedValues": [
                                        {
                                            "label": "None",
                                            "value": null
                                        },
                                        {
                                            "label": "Debug",
                                            "value": "lpr_Debug"
                                        },
                                        {
                                            "label": "Info",
                                            "value": "lpr_Info"
                                        },
                                        {
                                            "label": "Notice",
                                            "value": "lpr_Notice"
                                        },
                                        {
                                            "label": "Warning",
                                            "value": "lpr_Warning"
                                        },
                                        {
                                            "label": "Error",
                                            "value": "lpr_Error"
                                        },
                                        {
                                            "label": "Critical",
                                            "value": "lpr_Critical"
                                        },
                                        {
                                            "label": "Alert",
                                            "value": "lpr_Alert"
                                        },
                                        {
                                            "label": "Emergency",
                                            "value": "lpr_Emergency"
                                        }
                                    ]
                                },
                                "visible": true
                            },
                            {
                                "name": "facility16",
                                "type": "Microsoft.Common.DropDown",
                                "label": "LOG_MAIL",
                                "placeholder": "",
                                "toolTip": "",
                                "constraints": {
                                    "allowedValues": [
                                        {
                                            "label": "None",
                                            "value": null
                                        },
                                        {
                                            "label": "Debug",
                                            "value": "mail_Debug"
                                        },
                                        {
                                            "label": "Info",
                                            "value": "mail_Info"
                                        },
                                        {
                                            "label": "Notice",
                                            "value": "mail_Notice"
                                        },
                                        {
                                            "label": "Warning",
                                            "value": "mail_Warning"
                                        },
                                        {
                                            "label": "Error",
                                            "value": "mail_Error"
                                        },
                                        {
                                            "label": "Critical",
                                            "value": "mail_Critical"
                                        },
                                        {
                                            "label": "Alert",
                                            "value": "mail_Alert"
                                        },
                                        {
                                            "label": "Emergency",
                                            "value": "mail_Emergency"
                                        }
                                    ]
                                },
                                "visible": true
                            },
                            {
                                "name": "facility17",
                                "type": "Microsoft.Common.DropDown",
                                "label": "LOG_NEWS",
                                "placeholder": "",
                                "toolTip": "",
                                "constraints": {
                                    "allowedValues": [
                                        {
                                            "label": "None",
                                            "value": null
                                        },
                                        {
                                            "label": "Debug",
                                            "value": "news_Debug"
                                        },
                                        {
                                            "label": "Info",
                                            "value": "news_Info"
                                        },
                                        {
                                            "label": "Notice",
                                            "value": "news_Notice"
                                        },
                                        {
                                            "label": "Warning",
                                            "value": "news_Warning"
                                        },
                                        {
                                            "label": "Error",
                                            "value": "news_Error"
                                        },
                                        {
                                            "label": "Critical",
                                            "value": "news_Critical"
                                        },
                                        {
                                            "label": "Alert",
                                            "value": "news_Alert"
                                        },
                                        {
                                            "label": "Emergency",
                                            "value": "news_Emergency"
                                        }
                                    ]
                                },
                                "visible": true
                            },
                            {
                                "name": "facility18",
                                "type": "Microsoft.Common.DropDown",
                                "label": "LOG_SYSLOG",
                                "placeholder": "",
                                "toolTip": "",
                                "constraints": {
                                    "allowedValues": [
                                        {
                                            "label": "None",
                                            "value": null
                                        },
                                        {
                                            "label": "Debug",
                                            "value": "syslog_Debug"
                                        },
                                        {
                                            "label": "Info",
                                            "value": "syslog_Info"
                                        },
                                        {
                                            "label": "Notice",
                                            "value": "syslog_Notice"
                                        },
                                        {
                                            "label": "Warning",
                                            "value": "syslog_Warning"
                                        },
                                        {
                                            "label": "Error",
                                            "value": "syslog_Error"
                                        },
                                        {
                                            "label": "Critical",
                                            "value": "syslog_Critical"
                                        },
                                        {
                                            "label": "Alert",
                                            "value": "syslog_Alert"
                                        },
                                        {
                                            "label": "Emergency",
                                            "value": "syslog_Emergency"
                                        }
                                    ]
                                },
                                "visible": true
                            },
							{
  "name": "tempblock",
  "type": "Microsoft.Common.TextBlock",
  "visible": true,
  "options": {
    "text": "[concat(steps('DCR Creation').CollectSection.facility1,' ',steps('DCR Creation').CollectSection.facility2,' ',steps('DCR Creation').CollectSection.facility3,' ',steps('DCR Creation').CollectSection.facility4,' ',steps('DCR Creation').CollectSection.facility5,' ',steps('DCR Creation').CollectSection.facility6,' ',steps('DCR Creation').CollectSection.facility7,' ',steps('DCR Creation').CollectSection.facility8,' ',steps('DCR Creation').CollectSection.facility9,' ',steps('DCR Creation').CollectSection.facility10,' ',steps('DCR Creation').CollectSection.facility11,' ',steps('DCR Creation').CollectSection.facility12,' ',steps('DCR Creation').CollectSection.facility13,' ',steps('DCR Creation').CollectSection.facility14,' ',steps('DCR Creation').CollectSection.facility16,' ',steps('DCR Creation').CollectSection.facility17,' ',steps('DCR Creation').CollectSection.facility18)]"
	
  }
}

                        ]
                    }
                ]
            },
            {
                "name": "Data Ingestion Config",
                "label": "Data Ingestion Config",
                "bladeTitle": "Data Ingestion Config",
                "elements": [
                    {
                        "name": "dataingestionsection",
                        "type": "Microsoft.Common.Section",
                        "label": "Select Requirement for raw copy data",
                        "elements": [
                            {
                                "name": "flag-raw-copy-normdata",
                                "type": "Microsoft.Common.CheckBox",
                                "label": "Ingest raw copy of normalized data",
                                "constraints": {
                                    "required": false
                                }
                            },
                            {
                                "name": "rawdataacceptwarning",
                                "type": "Microsoft.Common.InfoBox",
                                "visible": "[steps('Data Ingestion Config').dataingestionsection.flag-raw-copy-normdata]",
                                "options": {
                                    "icon": "Warning",
                                    "text": "This will incur additional cost and select this only if necessary"
                                }
                            },
                            {
                                "name": "getexistingDCRs",
                                "type": "Microsoft.Solutions.ArmApiControl",
                                "toolTip": "This filters for existing DCRs available in the region",
                                "request": {
                                    "method": "GET",
                                    "path": "[concat(subscription().id, '/resourceGroups/', toLower(resourceGroup().name),'/providers/Microsoft.Insights/dataCollectionRules?api-version=2019-11-01-preview')]"
                                }
                            }
                        ]
                    },
                    {
                        "name": "dataingestionsection2",
                        "type": "Microsoft.Common.Section",
                        "label": "Data Collection rules DCR's configuration",
                        "elements": [
                            {
                                "name": "dcr-raw-data_name_input",
                                "type": "Microsoft.Common.DropDown",
                                "label": "DCR for Raw Data Ingestion",
                                "placeholder": "",
                                "defaultValue": "[concat('ms-sentinel-Zscalar-rawdata-dcr-',first(map(filter(basics('getLAWorkspace').value, (filter) => equals(filter.name,basics('loganalyticsworkspace'))), (item) => item.location)))]",
                                "toolTip": "Showing just for your reference only and don't edit this",
                                "constraints": {
                                    "allowedValues": [
                                        {
                                            "label": "[concat('ms-sentinel-Zscalar-rawdata-dcr-',first(map(filter(basics('getLAWorkspace').value, (filter) => equals(filter.name,basics('loganalyticsworkspace'))), (item) => item.location)))]",
                                            "value": "[concat('ms-sentinel-Zscalar-rawdata-dcr-',first(map(filter(basics('getLAWorkspace').value, (filter) => equals(filter.name,basics('loganalyticsworkspace'))), (item) => item.location)))]"
                                        }
                                    ],
                                    "required": false
                                },
                                "visible": false
                            },
                            {
                                "name": "DCRAlreadyExistsforRawData",
                                "type": "Microsoft.Common.InfoBox",
                                "visible": "[and(steps('Data Ingestion Config').dataingestionsection.flag-raw-copy-normdata,not(empty(filter(steps('Data Ingestion Config').dataingestionsection.getexistingDCRs.value, (item) => contains(item.name,concat('ms-sentinel-Zscalar-rawdata-dcr-',first(map(filter(basics('getLAWorkspace').value, (filter) => equals(filter.name,basics('loganalyticsworkspace'))), (item) => item.location))))))))]",
                                "options": {
                                    "icon": "Info",
                                    "text": "You already have DCR  <b> ms-sentinel-Zscalar-rawdata-dcr-[la region]  </b> with the above name in your environment. Select below if you want to refresh."
                                }
                            },
                            {
                                "name": "dcr-raw-data_refresh_flag",
                                "type": "Microsoft.Common.CheckBox",
                                "label": "Refresh existing DCR (DCR for raw data)",
                                "toolTip": "Selecting this override existing DCR, your updates / customizations will not be retained. So have a backup of your DCR and re-apply your modifications again after the deployment.",
                                "constraints": {
                                    "required": false
                                },
                                "visible": "[and(steps('Data Ingestion Config').dataingestionsection.flag-raw-copy-normdata,not(empty(filter(steps('Data Ingestion Config').dataingestionsection.getexistingDCRs.value, (item) => contains(item.name,concat('ms-sentinel-Zscalar-rawdata-dcr-',first(map(filter(basics('getLAWorkspace').value, (filter) => equals(filter.name,basics('loganalyticsworkspace'))), (item) => item.location))))))))]"
                            },
                            {
                                "name": "dcr-normalized-data_name_input",
                                "type": "Microsoft.Common.DropDown",
                                "label": "DCR for Normalized Data Ingestion",
                                "placeholder": "",
                                "defaultValue": "[concat('ms-sentinel-Zscalar-normdata-dcr-',first(map(filter(basics('getLAWorkspace').value, (filter) => equals(filter.name,basics('loganalyticsworkspace'))), (item) => item.location)))]",
                                "toolTip": "Showing just for your reference only and don't edit this",
                                "constraints": {
                                    "allowedValues": [
                                        {
                                            "label": "[concat('ms-sentinel-Zscalar-normdata-dcr-',first(map(filter(basics('getLAWorkspace').value, (filter) => equals(filter.name,basics('loganalyticsworkspace'))), (item) => item.location)))]",
                                            "value": "[concat('ms-sentinel-Zscalar-normdata-dcr-',first(map(filter(basics('getLAWorkspace').value, (filter) => equals(filter.name,basics('loganalyticsworkspace'))), (item) => item.location)))]"
                                        }
                                    ],
                                    "required": true
                                },
                                "visible": true
                            },
                            {
                                "name": "DCRAlreadyExistsforNormData",
                                "type": "Microsoft.Common.InfoBox",
                                "visible": "[not(empty(filter(steps('Data Ingestion Config').dataingestionsection.getexistingDCRs.value, (item) => contains(item.name,concat('ms-sentinel-Zscalar-normdata-dcr-',first(map(filter(basics('getLAWorkspace').value, (filter) => equals(filter.name,basics('loganalyticsworkspace'))), (item) => item.location)))))))]",
                                "options": {
                                    "icon": "Info",
                                    "text": "You already have DCR <b> ms-sentinel-Zscalar-normdata-dcr-[la region] </b> with the above name in your environment. Select below if you want to refresh."
                                }
                            },
                            {
                                "name": "dcr-normalized-data_refresh_flag",
                                "type": "Microsoft.Common.CheckBox",
                                "label": "Refresh existing DCR (DCR for normalized data)",
                                "toolTip": "Selecting this override existing DCR, your updates / customizations will not be retained. So have a backup of your DCR and re-apply your modifications again after the deployment.",
                                "constraints": {
                                    "required": false
                                },
                                "visible": "[not(empty(filter(steps('Data Ingestion Config').dataingestionsection.getexistingDCRs.value, (item) => contains(item.name,concat('ms-sentinel-Zscalar-normdata-dcr-',first(map(filter(basics('getLAWorkspace').value, (filter) => equals(filter.name,basics('loganalyticsworkspace'))), (item) => item.location)))))))]"
                            }
                        ]
                    },
                    {
                        "name": "dataingestionsection3",
                        "type": "Microsoft.Common.Section",
                        "label": "Following Normalizations are installed with this DCR rule",
                        "elements": [
                            {
                                "name": "text3",
                                "type": "Microsoft.Common.TextBlock",
                                "visible": true,
                                "options": {
                                    "text": " Zscalar - Network session normalization"
                                }
                            },
                            {
                                "name": "text4",
                                "type": "Microsoft.Common.TextBlock",
                                "visible": true,
                                "options": {
                                    "text": " Zscalar - Web session normalization"
                                }
                            },
                            {
                                "name": "text5",
                                "type": "Microsoft.Common.TextBlock",
                                "visible": true,
                                "options": {
                                    "text": " Zscalar - DNS Activity normalization"
                                }
                            }
                        ]
                    }
                ]
            }
        ],
        "outputs": {
            "loganalyticsworkspace": "[steps('basics').loganalyticsworkspace]",
            "loganalyticsworkspace-subscription": "[subscription().subscriptionId]",
            "loganalyticsworkspace-location": "[first(map(filter(basics('getLAWorkspace').value, (filter) => equals(filter.name,basics('loganalyticsworkspace'))), (item) => item.location))]",
            "loganalyticsworkspace-resourceGroup": "[first(map(filter(basics('getLAWorkspace').value, (filter) => equals(filter.name,basics('loganalyticsworkspace'))), (item) => substring(item.id, add(lastIndexOf(first(split(item.id,'/providers/')),'/'),1), sub(length(first(split(item.id,'/providers/'))), add(lastIndexOf(first(split(item.id,'/providers/')),'/'),1)) ) ))]",
            "DCR Name": "[steps('Data Ingestion Config').dataingestionsection2.dcr-normalized-data_name_input]",
            "VM Name": "[steps('DCR Creation').VMselectdropdown]",
            "VM Location": "[first(map(filter(steps('DCR Creation').vmselectapi.data, (filter) => equals(filter.name,steps('DCR Creation').VMselectdropdown)), (item) => item.location))]",
            "VM Type": "[first(map(filter(steps('DCR Creation').vmselectapi.data, (filter) => equals(filter.name,steps('DCR Creation').VMselectdropdown)), (item) => coalesce(item.properties_storageProfile_osDisk_osType,item.properties_osName)))]",
            "VM ResourceGroup Name": "[first(map(filter(steps('DCR Creation').vmselectapi.data, (filter) => equals(filter.name,steps('DCR Creation').VMselectdropdown)), (item) => item.resourceGroup))]",
            "VM Subscription ID": "[first(map(filter(steps('DCR Creation').vmselectapi.data, (filter) => equals(filter.name,steps('DCR Creation').VMselectdropdown)), (item) => item.subscriptionId))]",
            "Is Machine ARC Enabled": "[first(map(filter(steps('DCR Creation').vmselectapi.data, (filter) => equals(filter.name,steps('DCR Creation').VMselectdropdown)), (item) => if(contains(item.type,'hybrid'), 'True', 'False')))]",
			"Facility data": "[filter(map(split(steps('DCR Creation').CollectSection.tempblock,' '),(item) => parse(concat('{\"Facility\" : ',string(first(split(item,'_'))),',','\"Log_Level\" : ',if(equals(last(split(item,'_')),'Debug'),'[\"Debug\",\"Info\",\"Notice\",\"Warning\",\"Error\",\"Critical\",\"Alert\",\"Emergency\"]', if(equals(last(split(item,'_')),'Info'),'[\"Info\",\"Notice\",\"Warning\",\"Error\",\"Critical\",\"Alert\",\"Emergency\"]', if(equals(last(split(item,'_')),'Notice'),'[\"Notice\",\"Warning\",\"Error\",\"Critical\",\"Alert\",\"Emergency\"]', if(equals(last(split(item,'_')),'Warning'),'[\"Warning\",\"Error\",\"Critical\",\"Alert\",\"Emergency\"]', if(equals(last(split(item,'_')),'Error'),'[\"Error\",\"Critical\",\"Alert\",\"Emergency\"]', if(equals(last(split(item,'_')),'Critical'),'[\"Critical\",\"Alert\",\"Emergency\"]', if(equals(last(split(item,'_')),'Alert'),'[\"Alert\",\"Emergency\"]', if(equals(last(split(item,'_')),'Emergency'),'[\"Emergency\"]', '[]')))))))),'}'))),(var) => not(empty(var.Log_Level)))]",
			"Raw data": "true"
        },
        "resourceTypes": []
    }
}